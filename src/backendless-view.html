
<link rel="import" href="../bower_components/polymer/polymer-element.html">
<link rel="import" href="../bower_components/paper-button/paper-button.html">
<link rel="import" href="../bower_components/paper-input/paper-input.html">
<link rel="import" href="shared-styles.html">

<dom-module id="backendless-view">
  <template>
    <style include="shared-styles">
      :host {
        display: block;
        padding: 10px;
      }
    </style>

    <div class="card">
      <h1>Backendless Test</h1>
    </div>

    <div class="card">
        <paper-input style="width:20em" id="email" label="Email"></paper-input>
        <paper-input style="width:20em" id="password" label="Password"></paper-input>
        <paper-button on-tap="onTapRegister" raised>Register</paper-button>
        <paper-button on-tap="onTapLogin" raised>Login</paper-button>
        <paper-button on-tap="onTapLogout" raised>Logout</paper-button>
    </div>

    <div class="card">

        <paper-button on-tap="onTapCreateData" raised>Create Data</paper-button>
        <paper-button on-tap="onTapGetData" raised>Get Data</paper-button>

        <dom-repeat items="[[testTable]]" as="testTableEntry">
            <template>
                <div class="card">
                    <p>[[testTableEntry.data]]</p>
                </div>
            </template>
        </dom-repeat>

    </div>

  </template>

  <script>
    class BackendlessView extends Polymer.Element {
        static get is() { return 'backendless-view'; }

        // static get properties() {
        //     return {
        //         userToken: {
        //             type: String
        //         }
        //     };
        // }

        ready() {
            super.ready()
            this.testTable = [];
        }

        addTestTableEntry(testTableEntry) {
            this.push('testTable', testTableEntry);
        }

        onTapRegister() {

            console.log("onTapRegister called!");
            console.log("email: " + this.$.email.value);
            console.log("password: " + this.$.password.value);

            function userRegistered(user) {
                console.log("User has been registered!");
            }

            function gotError(err) {
                console.log("error message - " + err.message);
                console.log("error code - " + err.statusCode);
            }

            var user = new Backendless.User();
            user.email = this.$.email.value;
            user.password = this.$.password.value;

            Backendless.UserService.register( user ).then( userRegistered ).catch( gotError );
        }

        onTapLogin() {

            console.log("onTapLoginhandler called!");
            console.log("email: " + this.$.email.value);
            console.log("password: " + this.$.password.value);

            Backendless.UserService.login(this.$.email.value, this.$.password.value, true)
            .then(function(loggedInUser) {
                console.log("User has logged in!");
            })
            .catch(function(error) {
                console.log("error message - " + err.message);
                console.log("error code - " + err.statusCode);
            });
        }

        onTapLogout() {

            console.log("onTapLogout called!");

            Backendless.UserService.logout()
            .then(function() {
                console.log( "User has logged out!" );
            })
            .catch(function(error) {
                console.log( "error message - " + err.message );
                console.log( "error code - " + err.statusCode );
            });
        }

        onTapCreateData() {

            var self = this;

            console.log("onTapCreateData called!");

            Backendless.Data.of("TestTable").save( { data:"Some Test Data: " + Math.random()} )
            .then(function(obj) {
                console.log("object saved. objectId " + obj.objectId)
                self.addTestTableEntry(obj)
            } )
            .catch(function(error) {
                console.log("got error - " + error)
            })
        }

        onTapGetData() {

            var self = this;

            console.log("onTapGetData called!");

            Backendless.Data.of("TestTable").find()
            .then(function(result) {

                self.testTable = [];

                console.log("Loaded " + result.length + " objects!");

                for(var i = 0; i < result.length; i++) {
                    console.log("objectId = " + result[i].objectId);
                    self.addTestTableEntry(result[i])
                }
            })
            .catch(function(error) {
                console.log("got error - " + error)
            });
        }
    }

    window.customElements.define(BackendlessView.is, BackendlessView);

  </script>
</dom-module>
